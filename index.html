<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega da virada 2025</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
        }

        .input-group textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .participants-section {
            padding: 30px;
        }

        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .participant-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .participant-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .participant-card.paid {
            background: #d4edda;
            border-color: #28a745;
        }

        .participant-info {
            flex: 1;
        }

        .participant-number {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .participant-name {
            font-weight: 600;
            color: #212529;
            margin-bottom: 5px;
        }

        .participant-value {
            font-size: 1.1em;
            color: #28a745;
            font-weight: bold;
        }

        .payment-checkbox {
            width: 30px;
            height: 30px;
            cursor: pointer;
            accent-color: #28a745;
        }

        .admin-section {
            padding: 20px 30px;
            background: #fff3cd;
            border-bottom: 2px solid #ffc107;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .admin-section.logged-in {
            background: #d4edda;
            border-color: #28a745;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .admin-status {
            font-weight: 600;
            color: #856404;
        }

        .admin-section.logged-in .admin-status {
            color: #155724;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
        }

        .admin-controls .admin-input-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .admin-input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }

        .admin-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
        }

        .participant-card.read-only {
            opacity: 0.7;
        }

        .participant-card.read-only .payment-checkbox {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .add-participant-form {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #1976D2;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #90CAF9;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .btn-add {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-add:hover {
            transform: translateY(-2px);
        }

        .participant-card.editable {
            position: relative;
        }

        .edit-btn {
            position: absolute;
            top: 10px;
            right: 50px;
            background: #ff9800;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .participant-card.editable:hover .edit-btn {
            display: block;
        }

        .edit-form {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
        }

        .edit-form.active {
            display: block;
        }

        .edit-form input {
            width: 100px;
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ffc107;
            border-radius: 4px;
        }

        .btn-save-edit {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-cancel-edit {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }

        .btn-remove {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .participant-card.editable:hover .btn-remove {
            display: block;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        .validation-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .validation-error.show {
            display: block;
        }

        .load-base-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
        }

        .load-base-section.active {
            display: block;
        }

        .load-base-section h3 {
            color: #856404;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }

        .load-base-section h3:hover {
            color: #6c4a00;
        }

        .toggle-icon {
            font-size: 0.8em;
            transition: transform 0.3s;
        }

        .load-base-section.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .load-base-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .load-base-section.expanded .load-base-content {
            max-height: 1000px;
        }

        .search-section {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .search-section h3 {
            color: #1976D2;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 45px 12px 40px;
            border: 2px solid #90CAF9;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            color: #90CAF9;
            font-size: 18px;
            pointer-events: none;
            z-index: 1;
        }

        .clear-search {
            position: absolute;
            right: 15px;
            background: none;
            border: none;
            color: #90CAF9;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-search:hover {
            color: #2196F3;
        }

        .search-results-info {
            margin-top: 10px;
            font-size: 14px;
            color: #1976D2;
            font-weight: 600;
        }

        .participant-card.highlight {
            background: #fff9c4;
            border-color: #fbc02d;
            box-shadow: 0 4px 12px rgba(251, 192, 45, 0.3);
        }

        .participant-card.hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .participants-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                flex-direction: column;
                gap: 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ Mega da virada 2025</h1>
        </div>

        <div id="firebaseStatus" style="background: #e3f2fd; border: 2px solid #2196F3; border-radius: 10px; padding: 15px; margin-bottom: 20px; display: none;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="firebaseStatusIcon">üîÑ</span>
                <span id="firebaseStatusText">Verificando conex√£o...</span>
            </div>
        </div>

        <div class="admin-section" id="adminSection">
            <div class="admin-info">
                <span class="admin-status" id="adminStatus">üîí Acesso Restrito - Apenas Administradores</span>
            </div>
            <div class="admin-controls" id="adminControls">
                <div class="admin-input-wrapper">
                    <input type="password" class="admin-input" id="adminPassword" placeholder="Senha do Administrador" onkeypress="if(event.key === 'Enter') loginAdmin()">
                    <div id="masterPasswordHint" style="display: none; font-size: 11px; color: #666; margin-top: 5px; text-align: left;">
                        üí° Primeira vez? Digite a senha mestre para configurar
                    </div>
                </div>
                <button class="btn btn-small" onclick="loginAdmin()" id="loginBtn">Entrar</button>
                <button class="btn btn-small" onclick="logoutAdmin()" id="logoutBtn" style="display: none; background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);">Sair</button>
                <button class="btn btn-small" onclick="resetAdminPassword()" id="resetPasswordBtn" style="display: none; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">Redefinir Senha</button>
            </div>
        </div>

        <div class="input-section">
            <div id="firebaseStatus" style="background: #e3f2fd; border: 2px solid #2196F3; border-radius: 10px; padding: 15px; margin-bottom: 20px; display: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="firebaseStatusIcon">üîÑ</span>
                    <span id="firebaseStatusText">Verificando conex√£o...</span>
                </div>
            </div>
            <div class="load-base-section" id="loadBaseSection">
                <h3 onclick="toggleLoadBaseSection()">
                    <span>üîß √Årea do Administrador - Carregar Lista Base</span>
                    <span class="toggle-icon">‚ñº</span>
                </h3>
                <div class="load-base-content">
                    <div class="input-group">
                        <label for="participantsText">Cole aqui a lista base dos 52 participantes:</label>
                        <textarea id="participantsText" placeholder="Cole o texto com a lista de participantes aqui...">Mega da virada 2025

1-Erika Coleti R$ 30,00
2-Claudemir Pingo Coleti - R$ 20,00
 3-Midian Leite - R$ 20,00
4-Vitor Lopes - R$ 50,00
5-Wagner poker R$ 30,00
6-Marci√£o R$ 25,00
7-Foguinho R$ 25,00
8-Vanessa R$ 25,00
9-Aranon R$ 50,00
10-Rogerinho BB R$ 25,00
11-Reinaldo Gioprot R$ 50,00
12-Marco Doidera R$ 20,00
13-Shindi Poker R$ 30,00
14-J√©ssica Poker R$ 20,00
15-C√°tia prima R$ 20,00
16-Aline Rara R$ 15,00
17-Raiane Rara R$ 20,00
18-Iza BB R$ 10,00
19-Cesar Arama√ßan R$ 20,00
20-Fagner R$ 30,00
21-Raquel Dani R$ 20,00
22-Tatiana poker R$ 25,00
23-Gui Guedes R$ 100,00
24-Du Santana R$ 25,00
25-Ademir Poker R$ 30,00
26-Aroca arama√ßan R$ 20,00
26-Giba poker R$ 50,00
28-Viviane R$ 25,00
29-Tsuka R$ 25,00
30-Leandro Poker R$ 25,00
31-Marcus Poker R$ 50,00
32-Al√™ Hidalgo R$ 25,00
33-Souto Doidera R$ 30,00
34-Sergio Neto Poker R$ 20,00
35-Guilherme BB R$ 20,00
36-Cesar Machado Poker R$ 20,00
37-Evandro Doidera R$ 50,00
38-Lilian BB R$ 25,00
39-Luis Parisi R$ 50,00
40-Barba R$ 30,00
41-Eduardo Churros R$ 30,00
42-Silvio Lu√≠s -  R$ 50,00
43-Madson R$ 30,00
44-Beto R$ 20,00
45-Diego Matheus R$ 25,00
46-Adriana BB R$ 30,00
47-Paulo Bialtas  R$ 25,00
48-Pedro L. Morata R$ 50,00
49-Periclinho R$ 50,00
50-Felipe Gioprot R$ 50,00
51-Luciana BB - R$ 15,00
52-Sandro Spyger R$ 50,00</textarea>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="loadBaseParticipants()">Carregar Lista Base</button>
                        <button class="btn" onclick="clearAll()" id="clearBtn" style="background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);">Limpar Tudo</button>
                        <button class="btn" onclick="exportList()" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">Exportar Lista</button>
                        <button class="btn" onclick="exportData()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üíæ Exportar Dados</button>
                        <button class="btn" onclick="document.getElementById('importFileInput').click()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üì• Importar Dados</button>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="importData(event)">
                    </div>
                </div>
            </div>

            <div class="add-participant-form">
                <h3 style="color: #1976D2; margin-bottom: 15px;">‚ûï Adicionar Minha Aposta</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newParticipantName">Seu Nome:</label>
                        <input type="text" id="newParticipantName" placeholder="Digite seu nome completo">
                    </div>
                    <div class="form-group">
                        <label for="newParticipantValue">Valor da Aposta:</label>
                        <input type="text" id="newParticipantValue" placeholder="Ex: 30,00" onkeypress="if(event.key === 'Enter') addNewParticipant()" oninput="validateNewValue()">
                        <div class="validation-error" id="newValueError">Valor deve ser m√∫ltiplo de R$ 5,00 (m√≠nimo R$ 5,00)</div>
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn-add" onclick="addNewParticipant()">Adicionar Aposta</button>
                    </div>
                </div>
                <p style="font-size: 12px; color: #666; margin: 0;">üí° Qualquer pessoa pode adicionar sua aposta aqui. O administrador pode ajustar valores e marcar pagamentos.</p>
            </div>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="totalParticipants">0</div>
                <div class="stat-label">Participantes</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalValue">R$ 0,00</div>
                <div class="stat-label">Total Arrecadado</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="paidValue">R$ 0,00</div>
                <div class="stat-label">Total Pago</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="pendingValue">R$ 0,00</div>
                <div class="stat-label">Pendente</div>
            </div>
            <div class="stat-item" style="display: flex; align-items: center; justify-content: center;">
                <button class="btn" onclick="markAllAsPaid()" id="markAllPaidBtn" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); margin-top: 10px; display: none;">
                    ‚úÖ Marcar Todos como Pagos
                </button>
            </div>
        </div>

        <div class="participants-section">
            <div class="search-section">
                <h3>üîç Buscar Participante</h3>
                <div class="search-input-wrapper">
                    <span class="search-icon">üîç</span>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Digite o nome ou n√∫mero do participante..."
                        onkeyup="filterParticipants()"
                        oninput="filterParticipants()"
                    >
                    <button class="clear-search" id="clearSearchBtn" onclick="clearSearch()" style="display: none;">√ó</button>
                </div>
                <div class="search-results-info" id="searchResultsInfo" style="display: none;"></div>
            </div>
            <div id="participantsContainer">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    <h3>Nenhum participante carregado</h3>
                    <p>O administrador precisa carregar a lista base ou voc√™ pode adicionar sua aposta acima.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let participants = [];
        let isAdmin = false;
        const STORAGE_KEY = 'bolao_mega_sena_participants';
        const ADMIN_STORAGE_KEY = 'bolao_mega_sena_admin';
        const ADMIN_SETUP_KEY = 'bolao_mega_sena_admin_setup';
        // SENHA MESTRE: Apenas quem souber esta senha pode definir a senha do administrador pela primeira vez
        // IMPORTANTE: Altere esta senha antes de divulgar o HTML!
        const MASTER_PASSWORD = 'MEGA2025';
        
        // Configura√ß√£o do Firebase - SUBSTITUA COM SUAS CREDENCIAIS
        // Para obter as credenciais: https://console.firebase.google.com/
        const FIREBASE_CONFIG = {
            apiKey: "SUA_API_KEY_AQUI",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com/",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };
        
        let firebaseApp = null;
        let database = null;
        let useFirebase = false;
        
        // Inicializar Firebase
        function initFirebase() {
            try {
                // Verificar se as credenciais foram configuradas
                if (FIREBASE_CONFIG.apiKey && FIREBASE_CONFIG.apiKey !== "SUA_API_KEY_AQUI" && 
                    FIREBASE_CONFIG.databaseURL && FIREBASE_CONFIG.databaseURL !== "https://SEU_PROJETO-default-rtdb.firebaseio.com/") {
                    firebaseApp = firebase.initializeApp(FIREBASE_CONFIG);
                    database = firebase.database();
                    useFirebase = true;
                    console.log('‚úÖ Firebase conectado com sucesso!');
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Firebase n√£o configurado. Usando localStorage.');
                    useFirebase = false;
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erro ao conectar Firebase:', error);
                useFirebase = false;
                return false;
            }
        }
        
        function updateFirebaseStatus(connected) {
            const statusDiv = document.getElementById('firebaseStatus');
            const statusIcon = document.getElementById('firebaseStatusIcon');
            const statusText = document.getElementById('firebaseStatusText');
            
            if (statusDiv && statusIcon && statusText) {
                if (connected) {
                    statusDiv.style.display = 'block';
                    statusDiv.style.background = '#e8f5e9';
                    statusDiv.style.borderColor = '#4caf50';
                    statusIcon.textContent = '‚úÖ';
                    statusText.textContent = 'Conectado ao Firebase - Dados sincronizados em tempo real';
                } else {
                    statusDiv.style.display = 'block';
                    statusDiv.style.background = '#fff3cd';
                    statusDiv.style.borderColor = '#ffc107';
                    statusIcon.textContent = '‚ö†Ô∏è';
                    statusText.textContent = 'Firebase n√£o configurado - Usando armazenamento local (dados n√£o sincronizam entre dispositivos)';
                }
            }
        }

        // Carregar dados salvos ao iniciar
        window.addEventListener('DOMContentLoaded', () => {
            const firebaseConnected = initFirebase();
            updateFirebaseStatus(firebaseConnected);
            checkFirstTimeSetup();
            checkAdminSession();
            updateAdminUI();
            loadSavedData();
        });

        function parseParticipants(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const parsed = [];
            let title = '';

            lines.forEach((line, index) => {
                line = line.trim();
                
                // Primeira linha geralmente √© o t√≠tulo
                if (index === 0 && !line.match(/^\d+[-\s]/)) {
                    title = line;
                    return;
                }

                // Padr√µes aceitos:
                // 1-Erika Coleti R$ 30,00
                // 2-Claudemir Pingo Coleti - R$ 20,00
                // 26-Giba poker R$ 50,00
                // Remove espa√ßos extras e normaliza
                line = line.replace(/\s+/g, ' ').trim();
                
                const patterns = [
                    /^(\d+)[-\s]+(.+?)\s*[-]?\s*R\$\s*([\d.,]+)/i,  // Padr√£o principal com h√≠fen opcional
                    /^(\d+)[-\s]+(.+?)\s+R\$\s*([\d.,]+)/i,         // Sem h√≠fen antes do R$
                ];

                for (const pattern of patterns) {
                    const match = line.match(pattern);
                    if (match) {
                        const [, number, name, value] = match;
                        // Remove pontos de milhar e converte v√≠rgula para ponto
                        const cleanValue = value.replace(/\./g, '').replace(',', '.');
                        const numericValue = parseFloat(cleanValue);
                        
                        if (!isNaN(numericValue) && numericValue > 0) {
                            parsed.push({
                                number: parseInt(number),
                                name: name.trim().replace(/\s+/g, ' '),
                                value: numericValue,
                                paid: false
                            });
                            break;
                        }
                    }
                }
            });

            return { title, participants: parsed };
        }

        function loadBaseParticipants() {
            if (!isAdmin) {
                alert('Apenas administradores podem carregar a lista base!');
                return;
            }

            const text = document.getElementById('participantsText').value.trim();
            
            if (!text) {
                alert('Por favor, cole a lista de participantes!');
                return;
            }

            const result = parseParticipants(text);
            const baseParticipants = result.participants;

            // Carregar participantes existentes (para manter os adicionados manualmente)
            const existingParticipants = loadFromStorage() || [];
            
            // Mesclar: manter participantes adicionados manualmente e atualizar/adicionar da base
            const existingNumbers = new Set(existingParticipants.map(p => p.number));
            const newFromBase = baseParticipants.filter(p => !existingNumbers.has(p.number));
            
            // Atualizar valores e nomes dos que j√° existem (se vieram da base antes)
            existingParticipants.forEach(existing => {
                const fromBase = baseParticipants.find(bp => bp.number === existing.number);
                if (fromBase) {
                    // Atualizar nome e valor, mas manter status de pagamento
                    existing.name = fromBase.name;
                    existing.value = fromBase.value;
                }
            });

            // Combinar: existentes atualizados + novos da base
            participants = [...existingParticipants, ...newFromBase];
            
            // Ordenar por n√∫mero
            participants.sort((a, b) => a.number - b.number);

            renderParticipants();
            saveToStorage();
            alert(`‚úÖ Lista base carregada! ${baseParticipants.length} participantes da base.`);
        }

        function validateValue(value) {
            if (isNaN(value) || value <= 0) {
                return { valid: false, message: 'Valor inv√°lido' };
            }
            if (value < 5) {
                return { valid: false, message: 'Valor m√≠nimo √© R$ 5,00' };
            }
            if (value % 5 !== 0) {
                return { valid: false, message: 'Valor deve ser m√∫ltiplo de R$ 5,00' };
            }
            return { valid: true };
        }

        function validateNewValue() {
            const valueStr = document.getElementById('newParticipantValue').value.trim().replace(',', '.');
            const value = parseFloat(valueStr);
            const errorDiv = document.getElementById('newValueError');
            
            if (!valueStr) {
                errorDiv.classList.remove('show');
                return;
            }
            
            const validation = validateValue(value);
            if (!validation.valid) {
                errorDiv.textContent = validation.message;
                errorDiv.classList.add('show');
            } else {
                errorDiv.classList.remove('show');
            }
        }

        function addNewParticipant() {
            const name = document.getElementById('newParticipantName').value.trim();
            const valueStr = document.getElementById('newParticipantValue').value.trim().replace(',', '.');
            const value = parseFloat(valueStr);

            if (!name) {
                alert('Por favor, digite seu nome!');
                document.getElementById('newParticipantName').focus();
                return;
            }

            const validation = validateValue(value);
            if (!validation.valid) {
                alert(`‚ùå ${validation.message}`);
                document.getElementById('newParticipantValue').focus();
                document.getElementById('newValueError').classList.add('show');
                return;
            }

            // Encontrar pr√≥ximo n√∫mero dispon√≠vel
            const existingNumbers = participants.map(p => p.number);
            let nextNumber = 1;
            while (existingNumbers.includes(nextNumber)) {
                nextNumber++;
            }

            // Verificar se j√° existe algu√©m com esse nome
            const existing = participants.find(p => p.name.toLowerCase() === name.toLowerCase());
            if (existing) {
                if (confirm(`J√° existe um participante com o nome "${existing.name}". Deseja adicionar mesmo assim?`)) {
                    // Adicionar mesmo assim
                } else {
                    return;
                }
            }

            const newParticipant = {
                number: nextNumber,
                name: name,
                value: value,
                paid: false,
                addedManually: true
            };

            participants.push(newParticipant);
            participants.sort((a, b) => a.number - b.number);

            // Limpar formul√°rio
            document.getElementById('newParticipantName').value = '';
            document.getElementById('newParticipantValue').value = '';

            renderParticipants();
            saveToStorage();
            alert(`‚úÖ Aposta adicionada com sucesso! Seu n√∫mero √© #${nextNumber}`);
        }

        function editParticipant(index) {
            // Esconder outros formul√°rios de edi√ß√£o
            document.querySelectorAll('.edit-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Esconder erros de valida√ß√£o
            document.querySelectorAll('.validation-error').forEach(error => {
                error.classList.remove('show');
            });
            
            // Mostrar formul√°rio de edi√ß√£o
            const editForm = document.getElementById(`edit-form-${index}`);
            editForm.classList.add('active');
            
            // Adicionar valida√ß√£o em tempo real no campo de edi√ß√£o
            const editInput = document.getElementById(`edit-value-${index}`);
            editInput.oninput = function() {
                const valueStr = this.value.trim().replace(',', '.');
                const value = parseFloat(valueStr);
                const errorDiv = document.getElementById(`edit-error-${index}`);
                
                if (!valueStr) {
                    errorDiv.classList.remove('show');
                    return;
                }
                
                const validation = validateValue(value);
                if (!validation.valid) {
                    errorDiv.textContent = validation.message;
                    errorDiv.classList.add('show');
                } else {
                    errorDiv.classList.remove('show');
                }
            };
        }

        function saveEdit(index) {
            if (!isAdmin) {
                alert('Apenas administradores podem editar!');
                return;
            }

            const newValueStr = document.getElementById(`edit-value-${index}`).value.trim().replace(',', '.');
            const newValue = parseFloat(newValueStr);
            const errorDiv = document.getElementById(`edit-error-${index}`);

            const validation = validateValue(newValue);
            if (!validation.valid) {
                errorDiv.textContent = validation.message;
                errorDiv.classList.add('show');
                return;
            }

            errorDiv.classList.remove('show');

            participants[index].value = newValue;
            
            // Atualizar display
            document.getElementById(`value-${index}`).textContent = `R$ ${newValue.toFixed(2).replace('.', ',')}`;
            
            // Esconder formul√°rio
            document.getElementById(`edit-form-${index}`).classList.remove('active');
            
            saveToStorage();
            updateStats();
            
            // Manter o foco na busca se houver
            const searchValue = document.getElementById('searchInput')?.value.trim();
            if (searchValue) {
                setTimeout(() => {
                    filterParticipants();
                }, 100);
            }
        }

        function cancelEdit(index) {
            document.getElementById(`edit-form-${index}`).classList.remove('active');
            // Restaurar valor original
            const originalValue = participants[index].value;
            document.getElementById(`edit-value-${index}`).value = originalValue.toFixed(2).replace('.', ',');
            // Esconder erro
            document.getElementById(`edit-error-${index}`).classList.remove('show');
        }

        function removeParticipant(index, name) {
            if (!isAdmin) {
                alert('Apenas administradores podem remover participantes!');
                return;
            }

            const participant = participants[index];
            if (!participant) {
                return;
            }

            const confirmMessage = `‚ö†Ô∏è ATEN√á√ÉO!\n\nTem certeza que deseja remover o participante?\n\nNome: ${name}\nN√∫mero: #${participant.number}\nValor: R$ ${participant.value.toFixed(2).replace('.', ',')}\n\nEsta a√ß√£o n√£o pode ser desfeita!`;
            
            if (confirm(confirmMessage)) {
                participants.splice(index, 1);
                renderParticipants();
                saveToStorage();
                updateStats();
                
                // Manter o foco na busca se houver
                const searchValue = document.getElementById('searchInput')?.value.trim();
                if (searchValue) {
                    setTimeout(() => {
                        filterParticipants();
                    }, 100);
                }
            }
        }

        function renderParticipants() {
            const container = document.getElementById('participantsContainer');
            
            if (participants.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhum participante encontrado</h3>
                        <p>Verifique o formato do texto</p>
                    </div>
                `;
                document.getElementById('stats').style.display = 'none';
                return;
            }

            // Ordenar por n√∫mero
            participants.sort((a, b) => a.number - b.number);

            container.innerHTML = participants.map((p, index) => `
                <div class="participant-card ${p.paid ? 'paid' : ''} ${!isAdmin ? 'read-only' : 'editable'}" 
                     data-index="${index}" 
                     data-name="${p.name.toLowerCase()}" 
                     data-number="${p.number}">
                    ${isAdmin ? `<button class="btn-remove" onclick="removeParticipant(${index}, '${p.name.replace(/'/g, "\\'")}')" title="Remover apostador">üóëÔ∏è</button>` : ''}
                    <div class="participant-info">
                        <div class="participant-number">#${p.number}</div>
                        <div class="participant-name">${p.name}</div>
                        <div class="participant-value" id="value-${index}">R$ ${p.value.toFixed(2).replace('.', ',')}</div>
                    </div>
                    ${isAdmin ? `
                        <button class="edit-btn" onclick="editParticipant(${index})">‚úèÔ∏è Editar</button>
                        <div class="edit-form" id="edit-form-${index}">
                            <input type="text" id="edit-value-${index}" value="${p.value.toFixed(2).replace('.', ',')}" placeholder="Novo valor">
                            <div class="validation-error" id="edit-error-${index}">Valor deve ser m√∫ltiplo de R$ 5,00 (m√≠nimo R$ 5,00)</div>
                            <button class="btn-save-edit" onclick="saveEdit(${index})">Salvar</button>
                            <button class="btn-cancel-edit" onclick="cancelEdit(${index})">Cancelar</button>
                        </div>
                    ` : ''}
                    <input 
                        type="checkbox" 
                        class="payment-checkbox" 
                        ${p.paid ? 'checked' : ''}
                        ${!isAdmin ? 'disabled' : ''}
                        onchange="togglePayment(${p.number}, '${p.name.replace(/'/g, "\\'")}')"
                    >
                </div>
            `).join('');

            // Aplicar filtro se houver busca ativa
            const searchValue = document.getElementById('searchInput')?.value.trim();
            if (searchValue) {
                filterParticipants();
            }

            updateStats();
            document.getElementById('stats').style.display = 'flex';
        }

        function filterParticipants() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
            const resultsInfo = document.getElementById('searchResultsInfo');
            const searchValue = searchInput.value.trim().toLowerCase();
            
            if (!searchValue) {
                // Mostrar todos
                document.querySelectorAll('.participant-card').forEach(card => {
                    card.classList.remove('hidden', 'highlight');
                });
                clearBtn.style.display = 'none';
                resultsInfo.style.display = 'none';
                return;
            }

            clearBtn.style.display = 'block';
            
            let visibleCount = 0;
            let highlightedCount = 0;

            document.querySelectorAll('.participant-card').forEach(card => {
                const name = card.getAttribute('data-name') || '';
                const number = card.getAttribute('data-number') || '';
                const searchLower = searchValue.toLowerCase();
                
                // Buscar por nome ou n√∫mero
                const matchesName = name.includes(searchLower);
                const matchesNumber = number.toString().includes(searchLower);
                
                if (matchesName || matchesNumber) {
                    card.classList.remove('hidden');
                    card.classList.add('highlight');
                    visibleCount++;
                    highlightedCount++;
                } else {
                    card.classList.add('hidden');
                    card.classList.remove('highlight');
                }
            });

            // Atualizar informa√ß√£o de resultados
            if (visibleCount > 0) {
                resultsInfo.textContent = `‚úì ${visibleCount} participante(s) encontrado(s)`;
                resultsInfo.style.display = 'block';
                resultsInfo.style.color = '#1976D2';
            } else {
                resultsInfo.textContent = '‚úó Nenhum participante encontrado';
                resultsInfo.style.display = 'block';
                resultsInfo.style.color = '#d32f2f';
            }

            // Scroll para o primeiro resultado se houver
            if (highlightedCount > 0) {
                const firstHighlighted = document.querySelector('.participant-card.highlight:not(.hidden)');
                if (firstHighlighted) {
                    firstHighlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = '';
            filterParticipants();
            searchInput.focus();
        }

        function togglePayment(number, name) {
            if (!isAdmin) {
                alert('Apenas administradores podem alterar o status de pagamento!');
                return;
            }
            
            const participant = participants.find(p => p.number === number && p.name === name);
            if (participant) {
                participant.paid = !participant.paid;
                renderParticipants();
                saveToStorage();
            }
        }

        function getAdminPassword() {
            return localStorage.getItem(ADMIN_STORAGE_KEY);
        }

        function setAdminPassword(password) {
            localStorage.setItem(ADMIN_STORAGE_KEY, password);
            localStorage.setItem(ADMIN_SETUP_KEY, 'true');
        }

        function checkFirstTimeSetup() {
            // N√£o fazer nada automaticamente - deixar o usu√°rio fazer login
            // A senha mestre ser√° solicitada na primeira tentativa de login
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value.trim();
            const savedPassword = getAdminPassword();
            
            // Se n√£o h√° senha salva, esta √© a primeira vez - pedir senha mestre
            if (!savedPassword) {
                if (!password) {
                    alert('‚ö†Ô∏è Por favor, digite a senha mestre para configurar o administrador.\n\n(Entre em contato com o organizador do bol√£o para obter a senha mestre)');
                    return;
                }
                
                // Verificar senha mestre
                if (password === MASTER_PASSWORD) {
                    // Senha mestre correta - agora pedir para definir a senha do admin
                    const newAdminPassword = prompt('üîê CONFIGURA√á√ÉO DO ADMINISTRADOR\n\nSenha mestre confirmada!\n\nAgora defina uma senha para o administrador:\n\n(Esta ser√° a senha usada para fazer login e marcar pagamentos)', '');
                    
                    if (newAdminPassword && newAdminPassword.trim()) {
                        setAdminPassword(newAdminPassword.trim());
                        isAdmin = true;
                        sessionStorage.setItem('bolao_admin_session', 'true');
                        updateAdminUI();
                        document.getElementById('adminPassword').value = '';
                        // Carregar dados salvos se ainda n√£o foram carregados
                        if (participants.length === 0) {
                            loadSavedData();
                        } else {
                            renderParticipants();
                        }
                        alert('‚úÖ Senha de administrador definida com sucesso!\n\nUse a senha que voc√™ acabou de definir para fazer login nas pr√≥ximas vezes.');
                    } else {
                        alert('‚ö†Ô∏è Senha de administrador n√£o foi definida. Tente novamente.');
                        document.getElementById('adminPassword').value = '';
                    }
                } else {
                    alert('‚ùå Senha mestre incorreta!\n\nApenas o organizador do bol√£o pode definir a senha do administrador.\n\nEntre em contato para obter a senha mestre.');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
                return;
            }
            
            // Verificar senha do admin (j√° configurado) ou senha mestre
            if (password === savedPassword || password === MASTER_PASSWORD) {
                isAdmin = true;
                sessionStorage.setItem('bolao_admin_session', 'true');
                updateAdminUI();
                document.getElementById('adminPassword').value = '';
                // Carregar dados salvos se ainda n√£o foram carregados
                if (participants.length === 0) {
                    loadSavedData();
                } else {
                    renderParticipants(); // Re-render para habilitar checkboxes
                }
            } else {
                alert('‚ùå Senha incorreta!');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        function logoutAdmin() {
            isAdmin = false;
            sessionStorage.removeItem('bolao_admin_session');
            updateAdminUI();
            renderParticipants(); // Re-render para desabilitar checkboxes
        }

        function checkAdminSession() {
            const session = sessionStorage.getItem('bolao_admin_session');
            if (session === 'true') {
                isAdmin = true;
                updateAdminUI();
            }
        }

        function updateAdminUI() {
            const adminSection = document.getElementById('adminSection');
            const adminStatus = document.getElementById('adminStatus');
            const logoutBtn = document.getElementById('logoutBtn');
            const passwordInput = document.getElementById('adminPassword');
            const clearBtn = document.getElementById('clearBtn');
            const loginBtn = document.getElementById('loginBtn');
            const resetPasswordBtn = document.getElementById('resetPasswordBtn');
            const loadBaseSection = document.getElementById('loadBaseSection');
            const savedPassword = getAdminPassword();
            
            if (isAdmin) {
                adminSection.classList.add('logged-in');
                adminStatus.textContent = '‚úÖ Administrador Logado';
                logoutBtn.style.display = 'block';
                if (resetPasswordBtn) resetPasswordBtn.style.display = 'block';
                passwordInput.style.display = 'none';
                if (loginBtn) loginBtn.style.display = 'none';
                if (clearBtn) clearBtn.disabled = false;
                if (loadBaseSection) {
                    loadBaseSection.classList.add('active');
                }
                // Mostrar bot√£o "Marcar Todos como Pagos" apenas para admin
                const markAllBtn = document.getElementById('markAllPaidBtn');
                if (markAllBtn) {
                    markAllBtn.style.display = 'block';
                }
            } else {
                adminSection.classList.remove('logged-in');
                const masterPasswordHint = document.getElementById('masterPasswordHint');
                if (!savedPassword) {
                    adminStatus.textContent = 'üîê Configura√ß√£o Inicial - Senha Mestre Necess√°ria';
                    passwordInput.placeholder = 'Senha mestre';
                    if (loginBtn) loginBtn.textContent = 'Configurar Admin';
                    if (masterPasswordHint) masterPasswordHint.style.display = 'block';
                } else {
                    adminStatus.textContent = 'üîí Acesso Restrito - Apenas Administradores';
                    passwordInput.placeholder = 'Senha do Administrador';
                    if (loginBtn) loginBtn.textContent = 'Entrar';
                    if (masterPasswordHint) masterPasswordHint.style.display = 'none';
                }
                logoutBtn.style.display = 'none';
                if (resetPasswordBtn) resetPasswordBtn.style.display = 'none';
                passwordInput.style.display = 'block';
                if (loginBtn) loginBtn.style.display = 'block';
                if (clearBtn) clearBtn.disabled = true;
                if (loadBaseSection) {
                    loadBaseSection.classList.remove('active');
                    loadBaseSection.classList.remove('expanded');
                }
                // Esconder bot√£o "Marcar Todos como Pagos" para n√£o-admin
                const markAllBtn = document.getElementById('markAllPaidBtn');
                if (markAllBtn) {
                    markAllBtn.style.display = 'none';
                }
            }
        }

        function toggleLoadBaseSection() {
            if (!isAdmin) {
                return;
            }
            const loadBaseSection = document.getElementById('loadBaseSection');
            if (loadBaseSection) {
                loadBaseSection.classList.toggle('expanded');
            }
        }

        function updateStats() {
            const total = participants.length;
            const totalValue = participants.reduce((sum, p) => sum + p.value, 0);
            const paidValue = participants.filter(p => p.paid).reduce((sum, p) => sum + p.value, 0);
            const pendingValue = totalValue - paidValue;

            document.getElementById('totalParticipants').textContent = total;
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('paidValue').textContent = formatCurrency(paidValue);
            document.getElementById('pendingValue').textContent = formatCurrency(pendingValue);
        }

        function formatCurrency(value) {
            return `R$ ${value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.')}`;
        }

        function saveToStorage() {
            const dataToSave = participants.map(p => ({
                number: p.number,
                name: p.name,
                value: p.value,
                paid: p.paid
            }));
            // Salvar no localStorage como backup
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            
            // Salvar no Firebase se estiver configurado
            if (useFirebase && database) {
                database.ref('participants').set(dataToSave)
                    .then(() => {
                        console.log('‚úÖ Dados salvos no Firebase');
                    })
                    .catch((error) => {
                        console.error('‚ùå Erro ao salvar no Firebase:', error);
                    });
            }
        }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : null;
            } catch (e) {
                return null;
            }
        }

        function loadSavedData() {
            if (useFirebase && database) {
                // Carregar do Firebase
                database.ref('participants').once('value')
                    .then((snapshot) => {
                        const data = snapshot.val();
                        if (data && Array.isArray(data) && data.length > 0) {
                            participants = data;
                            renderParticipants();
                            updateStats();
                            // Sincronizar com localStorage
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(participants));
                            console.log('‚úÖ Dados carregados do Firebase');
                        } else {
                            // Se n√£o houver dados no Firebase, tentar localStorage
                            const saved = loadFromStorage();
                            if (saved && saved.length > 0) {
                                participants = saved;
                                renderParticipants();
                                // Sincronizar com Firebase
                                saveToStorage();
                            }
                        }
                    })
                    .catch((error) => {
                        console.error('‚ùå Erro ao carregar do Firebase:', error);
                        // Em caso de erro, usar localStorage
                        const saved = loadFromStorage();
                        if (saved && saved.length > 0) {
                            participants = saved;
                            renderParticipants();
                        }
                    });
                
                // Escutar mudan√ßas em tempo real
                database.ref('participants').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && Array.isArray(data) && data.length > 0) {
                        // S√≥ atualizar se os dados forem diferentes (evitar loop)
                        const dataStr = JSON.stringify(data);
                        const currentStr = JSON.stringify(participants);
                        if (dataStr !== currentStr) {
                            participants = data;
                            renderParticipants();
                            updateStats();
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(participants));
                            console.log('üîÑ Dados sincronizados do Firebase');
                        }
                    }
                });
            } else {
                // Usar apenas localStorage se Firebase n√£o estiver configurado
                const saved = loadFromStorage();
                if (saved && saved.length > 0) {
                    participants = saved;
                    renderParticipants();
                }
            }
        }

        function clearAll() {
            if (!isAdmin) {
                alert('Apenas administradores podem limpar os dados!');
                return;
            }
            
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nTem certeza que deseja limpar TODOS os dados?\n\nIsso inclui:\n- Lista de participantes\n- Status de pagamentos\n\n(A senha do administrador ser√° mantida)')) {
                participants = [];
                document.getElementById('participantsText').value = '';
                localStorage.removeItem(STORAGE_KEY);
                document.getElementById('participantsContainer').innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11l3 3L22 4"></path>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        <h3>Nenhum participante carregado</h3>
                        <p>Cole a lista de participantes no campo acima e clique em "Processar Participantes"</p>
                    </div>
                `;
                document.getElementById('stats').style.display = 'none';
            }
        }

        function resetAdminPassword() {
            if (!isAdmin) {
                alert('Apenas administradores podem redefinir a senha!');
                return;
            }
            
            if (confirm('‚ö†Ô∏è Tem certeza que deseja redefinir a senha do administrador?\n\nVoc√™ precisar√° definir uma nova senha.')) {
                localStorage.removeItem(ADMIN_STORAGE_KEY);
                localStorage.removeItem(ADMIN_SETUP_KEY);
                isAdmin = false;
                sessionStorage.removeItem('bolao_admin_session');
                updateAdminUI();
                alert('‚úÖ Senha removida. Defina uma nova senha no campo acima.');
            }
        }

        function exportList() {
            if (participants.length === 0) {
                alert('N√£o h√° participantes para exportar!');
                return;
            }

            const paid = participants.filter(p => p.paid);
            const pending = participants.filter(p => !p.paid);

            let exportText = '=== BOL√ÉO MEGA SENA - RELAT√ìRIO ===\n\n';
            exportText += `Total de Participantes: ${participants.length}\n`;
            exportText += `Total Arrecadado: ${formatCurrency(participants.reduce((s, p) => s + p.value, 0))}\n`;
            exportText += `Total Pago: ${formatCurrency(paid.reduce((s, p) => s + p.value, 0))}\n`;
            exportText += `Total Pendente: ${formatCurrency(pending.reduce((s, p) => s + p.value, 0))}\n\n`;

            exportText += '=== PAGOS ===\n';
            paid.forEach(p => {
                exportText += `${p.number}-${p.name} - R$ ${p.value.toFixed(2).replace('.', ',')}\n`;
            });

            exportText += '\n=== PENDENTES ===\n';
            pending.forEach(p => {
                exportText += `${p.number}-${p.name} - R$ ${p.value.toFixed(2).replace('.', ',')}\n`;
            });

            // Criar e baixar arquivo
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bolao_mega_sena_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function markAllAsPaid() {
            if (!isAdmin) {
                alert('Apenas administradores podem marcar pagamentos!');
                return;
            }

            if (participants.length === 0) {
                alert('N√£o h√° participantes para marcar!');
                return;
            }

            const pendingCount = participants.filter(p => !p.paid).length;
            
            if (pendingCount === 0) {
                alert('Todos os participantes j√° est√£o marcados como pagos!');
                return;
            }

            const confirmMessage = `‚ö†Ô∏è ATEN√á√ÉO!\n\nTem certeza que deseja marcar TODOS os ${pendingCount} participante(s) pendente(s) como PAGOS?\n\nEsta a√ß√£o marcar√° todos os participantes que ainda n√£o pagaram.`;
            
            if (confirm(confirmMessage)) {
                participants.forEach(p => {
                    p.paid = true;
                });
                
                renderParticipants();
                saveToStorage();
                updateStats();
                
                alert(`‚úÖ ${pendingCount} participante(s) marcado(s) como pago(s) com sucesso!`);
            }
        }

        function exportData() {
            if (!isAdmin) {
                alert('Apenas administradores podem exportar dados!');
                return;
            }

            const dataToExport = {
                participants: participants,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };

            const jsonString = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().split('T')[0].replace(/-/g, '');
            a.download = `mega_virada_2025_backup_${dateStr}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Dados exportados com sucesso!\n\nSalve este arquivo para restaurar os dados em outro PC.');
        }

        function importData(event) {
            if (!isAdmin) {
                alert('Apenas administradores podem importar dados!');
                return;
            }

            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.participants || !Array.isArray(importedData.participants)) {
                        alert('‚ùå Arquivo inv√°lido! O arquivo n√£o cont√©m dados de participantes v√°lidos.');
                        return;
                    }

                    const confirmMessage = `‚ö†Ô∏è ATEN√á√ÉO!\n\nVoc√™ est√° prestes a importar ${importedData.participants.length} participante(s).\n\nIsso vai SUBSTITUIR todos os dados atuais!\n\nDeseja continuar?`;
                    
                    if (confirm(confirmMessage)) {
                        participants = importedData.participants;
                        saveToStorage();
                        renderParticipants();
                        updateStats();
                        
                        alert(`‚úÖ Dados importados com sucesso!\n\n${importedData.participants.length} participante(s) carregado(s).`);
                    }
                } catch (error) {
                    alert('‚ùå Erro ao importar dados!\n\nO arquivo pode estar corrompido ou em formato inv√°lido.\n\nErro: ' + error.message);
                }
                
                // Limpar o input para permitir importar o mesmo arquivo novamente
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }
    </script>
</body>
</html>

